FROM openjdk:17-slim

WORKDIR /app

ENV ACTIVE_PROFILE=${ACTIVE_PROFILE}

ENV MYSQL_HOST=${MYSQL_HOST}
ENV MYSQL_PORT=${MYSQL_PORT}
ENV MYSQL_USER=${MYSQL_USER}
ENV MYSQL_PASSWORD=${MYSQL_PASSWORD}

ENV ANALYSIS_SERVER_HOST=${ANALYSIS_SERVER_HOST}
ENV ANALYSIS_SERVER_PORT=${ANALYSIS_SERVER_PORT}
ENV VIRTUAL_FIREWALL_HOST=${VIRTUAL_FIREWALL_HOST}
ENV VIRTUAL_FIREWALL_PORT=${VIRTUAL_FIREWALL_PORT}
ENV VIRTUAL_WEB_SERVER_HOST=${VIRTUAL_WEB_SERVER_HOST}
ENV VIRTUAL_WEB_SERVER_PORT=${VIRTUAL_WEB_SERVER_PORT}
ENV VIRTUAL_WEB_APPLICATION_SERVER_HOST=${VIRTUAL_WEB_APPLICATION_SERVER_HOST}
ENV VIRTUAL_WEB_APPLICATION_SERVER_PORT=${VIRTUAL_WEB_APPLICATION_SERVER_PORT}

ARG JAR_PATH=./build/libs

COPY ${JAR_PATH}/*.jar ./app.jar

CMD ["java","-jar","./app.jar", "--spring.profiles.active=${ACTIVE_PROFILE}", "-DMYSQL_HOST=${MYSQL_HOST}", "-DMYSQL_PORT=${MYSQL_PORT}", "-DMYSQL_USER=${MYSQL_USER}", "-DMYSQL_PASSWORD=${MYSQL_PASSWORD}", "-DANALYSIS_SERVER_HOST=${ANALYSIS_SERVER_HOST}", "-DANALYSIS_SERVER_PORT=${ANALYSIS_SERVER_PORT}", "-DVIRTUAL_FIREWALL_HOST=${VIRTUAL_FIREWALL_HOST}", "-DVIRTUAL_FIREWALL_PORT=${VIRTUAL_FIREWALL_PORT}", "-DVIRTUAL_WEB_SERVER_HOST=${VIRTUAL_WEB_SERVER_HOST}", "-DVIRTUAL_WEB_SERVER_PORT=${VIRTUAL_WEB_SERVER_PORT}", "-DVIRTUAL_WEB_APPLICATION_SERVER_HOST=${VIRTUAL_WEB_APPLICATION_SERVER_HOST}", "-DVIRTUAL_WEB_APPLICATION_SERVER_PORT=${VIRTUAL_WEB_APPLICATION_SERVER_PORT}"]